# Run lint-staged for formatting and linting
pnpm exec lint-staged

# Check if test-related files are being committed
TEST_FILES=$(git diff --cached --name-only | grep -E "\.(test|spec)\.(js|jsx|ts|tsx)$|vitest\.config|jest\.config|setup\.(js|ts)" | wc -l)

# Check if source files that might affect tests are being committed
SRC_FILES=$(git diff --cached --name-only | grep -E "^src/.*\.(js|jsx|ts|tsx)$" | wc -l)

# Run tests only if test files or source files are modified AND test files exist
if [ "$TEST_FILES" -gt 0 ] || [ "$SRC_FILES" -gt 0 ]; then
  # Check if any test files actually exist before running tests
  if find tests src -name "*.test.*" -o -name "*.spec.*" 2>/dev/null | grep -q .; then
    echo "ðŸ§ª Running tests because test or source files were modified..."
    pnpm test:run
  else
    echo "âš¡ Skipping tests - no test files found in project"
  fi
else
  echo "âš¡ Skipping tests - no test or source files modified"
fi

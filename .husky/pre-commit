#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Run lint-staged for formatting and linting
pnpm exec lint-staged

# Check if test-related files are being committed
TEST_FILES=$(git diff --cached --name-only | grep -E "\.(test|spec)\.(js|jsx|ts|tsx)$|vitest\.config|jest\.config|setup\.(js|ts)" | wc -l)

# Check if source files that might affect tests are being committed
SRC_FILES=$(git diff --cached --name-only | grep -E "^src/.*\.(js|jsx|ts|tsx)$" | wc -l)

# Run tests only if test files or source files are modified
if [ "$TEST_FILES" -gt 0 ] || [ "$SRC_FILES" -gt 0 ]; then
  echo "ðŸ§ª Running tests because test or source files were modified..."
  pnpm test:run
else
  echo "âš¡ Skipping tests - no test or source files modified"
fi
